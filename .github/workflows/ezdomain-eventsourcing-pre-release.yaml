name: .NET

on:
  workflow_dispatch:
    branches: [ "pre-release" ]
    paths:
      - 'src/EventSourcing/EzDomain.EventSourcing/**'

defaults:
  run:
    working-directory: ./src

env:
  VERSION_PREFIX: 7.0.0

jobs:
  pack:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET 7
      uses: actions/setup-dotnet@v3
      with: 
        dotnet-version: 7.0.x
    - name: Show API key
      run: echo ${{secrets.NUGET_API_KEY}}
    - name: Pack pre-release
      run: |
        dotnet pack EventSourcing/EzDomain.EventSourcing/EzDomain.EventSourcing.csproj --configuration Release -p:VersionPrefix=$VERSION_PREFIX --version-suffix=build.${{github.run_number}} --output ./nuget/packages
        dotnet pack EventSourcing/EzDomain.EventSourcing/EzDomain.EventSourcing.csproj --configuration Release -p:VersionPrefix=$VERSION_PREFIX --output ./nuget/packages
    - name: Push pre-release
      run: |
        dotnet nuget push './nuget/packages/EzDomain.EventSourcing.7.0.0-build.${{github.run_number}}.nupkg' -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json
      
